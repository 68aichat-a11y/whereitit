(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const q="modulepreload",W=function(e){return"/whereitit/"+e},D={},_=function(t,n,a){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(n.map(c=>{if(c=W(c),c in D)return;D[c]=!0;const l=c.endsWith(".css"),V=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${V}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":q,l||(d.as="script"),d.crossOrigin="",d.href=c,s&&d.setAttribute("nonce",s),document.head.appendChild(d),l)return new Promise((H,N)=>{d.addEventListener("load",H),d.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return r.then(i=>{for(const s of i||[])s.status==="rejected"&&o(s.reason);return t().catch(o)})},b=(e,t)=>t.some(n=>e instanceof n);let T,x;function z(){return T||(T=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Q(){return x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const B=new WeakMap,p=new WeakMap,h=new WeakMap;function G(e){const t=new Promise((n,a)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{n(g(e.result)),r()},i=()=>{a(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)});return h.set(t,e),t}function J(e){if(B.has(e))return;const t=new Promise((n,a)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{n(),r()},i=()=>{a(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});B.set(e,t)}let k={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return B.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function F(e){k=e(k)}function X(e){return Q().includes(e)?function(...t){return e.apply(L(this),t),g(this.request)}:function(...t){return g(e.apply(L(this),t))}}function Y(e){return typeof e=="function"?X(e):(e instanceof IDBTransaction&&J(e),b(e,z())?new Proxy(e,k):e)}function g(e){if(e instanceof IDBRequest)return G(e);if(p.has(e))return p.get(e);const t=Y(e);return t!==e&&(p.set(e,t),h.set(t,e)),t}const L=e=>h.get(e);function Z(e,t,{blocked:n,upgrade:a,blocking:r,terminated:o}={}){const i=indexedDB.open(e,t),s=g(i);return a&&i.addEventListener("upgradeneeded",c=>{a(g(i.result),c.oldVersion,c.newVersion,g(i.transaction),c)}),n&&i.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),s.then(c=>{o&&c.addEventListener("close",()=>o()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),s}const ee=["get","getKey","getAll","getAllKeys","count"],te=["put","add","delete","clear"],E=new Map;function M(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(E.get(t))return E.get(t);const n=t.replace(/FromIndex$/,""),a=t!==n,r=te.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(r||ee.includes(n)))return;const o=async function(i,...s){const c=this.transaction(i,r?"readwrite":"readonly");let l=c.store;return a&&(l=l.index(s.shift())),(await Promise.all([l[n](...s),r&&c.done]))[0]};return E.set(t,o),o}F(e=>({...e,get:(t,n,a)=>M(t,n)||e.get(t,n,a),has:(t,n)=>!!M(t,n)||e.has(t,n)}));const ne=["continue","continuePrimaryKey","advance"],j={},S=new WeakMap,K=new WeakMap,ae={get(e,t){if(!ne.includes(t))return e[t];let n=j[t];return n||(n=j[t]=function(...a){S.set(this,K.get(this)[t](...a))}),n}};async function*re(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ae);for(K.set(n,t),h.set(n,L(t));t;)yield n,t=await(S.get(n)||t.continue()),S.delete(n)}function O(e,t){return t===Symbol.asyncIterator&&b(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&b(e,[IDBIndex,IDBObjectStore])}F(e=>({...e,get(t,n,a){return O(t,n)?re:e.get(t,n,a)},has(t,n){return O(t,n)||e.has(t,n)}}));const oe={screwdriver:"Skruvmejsel",hammer:"Hammare",wrench:"Skiftnyckel",pliers:"T√•ng",drill:"Borr",saw:"S√•g",tool:"Verktyg",toolbox:"Verktygsl√•da",scissors:"Sax",knife:"Kniv",tape:"Tejp","measuring tape":"M√•ttband",level:"Vattenpass",ladder:"Stege",box:"L√•da","cardboard box":"Kartong","plastic box":"Plastl√•da",container:"Beh√•llare","storage box":"F√∂rvaringsl√•da",bin:"L√•da",crate:"L√•da",phone:"Telefon",smartphone:"Smartphone",laptop:"Laptop",computer:"Dator",tablet:"Surfplatta",keyboard:"Tangentbord",mouse:"Mus",cable:"Kabel",charger:"Laddare",battery:"Batteri",remote:"Fj√§rrkontroll",headphones:"H√∂rlurar",shirt:"Skjorta",jacket:"Jacka",shoes:"Skor",hat:"M√∂ssa",gloves:"Handskar",bag:"V√§ska",backpack:"Ryggs√§ck",book:"Bok",notebook:"Anteckningsbok",paper:"Papper",pen:"Penna",pencil:"Blyertspenna",folder:"Mapp",document:"Dokument",cup:"Kopp",mug:"Mugg",plate:"Tallrik",bowl:"Sk√•l",bottle:"Flaska",glass:"Glas",pot:"Gryta",pan:"Stekpanna",chair:"Stol",table:"Bord",shelf:"Hylla",drawer:"L√•da",cabinet:"Sk√•p",key:"Nyckel",watch:"Klocka",clock:"Klocka",lamp:"Lampa",light:"Lampa",toy:"Leksak",ball:"Boll",bicycle:"Cykel",car:"Bil"};function ie(e){if(!e)return"";const t=e.toLowerCase();for(const[a,r]of Object.entries(oe))if(t.includes(a))return r;const n=e.split(" ")[0];return n.charAt(0).toUpperCase()+n.slice(1)}let m,f=null,y=!1,I=null;function C(){const e=localStorage.getItem("enableAI");return e===null?!0:e==="true"}function se(e){localStorage.setItem("enableAI",e.toString())}async function ce(){m=await Z("WhereItItDB",1,{upgrade(e){if(!e.objectStoreNames.contains("items")){const t=e.createObjectStore("items",{keyPath:"id",autoIncrement:!0});t.createIndex("title","title"),t.createIndex("location","location")}}})}async function le(e){e.id?await m.put("items",e):(e.createdAt=new Date().toISOString(),await m.add("items",e))}async function v(){return await m.getAll("items")}async function de(e){await m.delete("items",e)}async function ue(e){const t=await v();if(!e)return t;const n=e.toLowerCase();return t.filter(a=>a.title.toLowerCase().includes(n)||a.location.toLowerCase().includes(n))}function P(e){return new Promise((t,n)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=n,a.readAsDataURL(e)})}async function me(){if(I)return I;try{console.log("Laddar Transformers.js bibliotek...");const e=await _(()=>import("https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.0"),[]);return e.env.allowLocalModels=!1,e.env.useBrowserCache=!0,I=e,console.log("Transformers.js bibliotek laddat!"),e}catch(e){return console.error("Kunde inte ladda Transformers.js:",e),null}}async function U(){if(f)return f;if(y){for(;y;)await new Promise(e=>setTimeout(e,100));return f}try{y=!0,console.log("Laddar AI-modell f√∂r bildigenk√§nning...");const e=await me();return e?(f=await e.pipeline("image-to-text","Xenova/vit-gpt2-image-captioning"),console.log("AI-modell laddad!"),f):null}catch(e){return console.error("Kunde inte ladda AI-modell:",e),null}finally{y=!1}}async function ge(e){try{const t=await U();if(!t)return console.log("AI-modell inte tillg√§nglig"),null;console.log("Analyserar bild...");const a=(await t(e))[0].generated_text;console.log("AI svarade:",a);const r=ie(a);return console.log("√ñversatt till:",r),r}catch(t){return console.error("Fel vid bildanalys:",t),null}}async function fe(e){try{const t=await U();if(!t)return console.log("AI-modell inte tillg√§nglig"),null;console.log("Analyserar bild f√∂r s√∂kning...");const a=(await t(e))[0].generated_text;return console.log("AI beskrivning:",a),a}catch(t){return console.error("Fel vid bildanalys:",t),null}}async function ye(e){const t=await v();if(!e)return t;const n=e.toLowerCase().split(/\s+/);return t.map(r=>{let o=0;const i=`${r.title} ${r.location}`.toLowerCase();return n.forEach(s=>{i.includes(s)&&(o+=1)}),{item:r,score:o}}).filter(({score:r})=>r>0).sort((r,o)=>o.score-r.score).map(({item:r})=>r)}async function u(e=null){const t=document.getElementById("itemsContainer");if(e||(e=await v()),e.length===0){t.innerHTML=`
            <div class="empty-state">
                <div style="font-size: 4rem;">üì¶</div>
                <p>Inga saker √§nnu. L√§gg till din f√∂rsta sak!</p>
            </div>
        `;return}t.innerHTML=e.map(n=>`
        <div class="item-card" onclick="showItemModal(${n.id})">
            ${n.image?`<img src="${n.image}" alt="${n.title}" class="item-image">`:'<div class="item-image placeholder">üì¶</div>'}
            <div class="item-info">
                <h3>${n.title}</h3>
                <p>üìç ${n.location}</p>
            </div>
        </div>
    `).join("")}window.showItemModal=async function(e){const t=await m.get("items",e),n=document.getElementById("itemModal");document.getElementById("modalImage").src=t.image||"",document.getElementById("modalImage").style.display=t.image?"block":"none",document.getElementById("modalTitle").textContent=t.title,document.getElementById("modalQuantity").textContent=t.quantity,document.getElementById("modalLocation").textContent=t.location,document.getElementById("modalEdit").onclick=()=>{n.classList.remove("active"),editItem(e)},document.getElementById("modalDelete").onclick=()=>{n.classList.remove("active"),removeItem(e)},n.classList.add("active")};window.editItem=async function(e){const t=await m.get("items",e);document.getElementById("itemTitle").value=t.title,document.getElementById("itemQuantity").value=t.quantity,document.getElementById("itemLocation").value=t.location,t.image&&(document.getElementById("imagePreview").innerHTML=`<img src="${t.image}" alt="Preview">`),document.getElementById("itemForm").dataset.editId=e,document.getElementById("cancelBtn").style.display="inline-block",w("add")};window.removeItem=async function(e){confirm("√Ñr du s√§ker p√• att du vill ta bort denna sak?")&&(await de(e),await u())};function w(e){if(document.querySelectorAll(".tab-btn").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.getElementById(`${e}Tab`).classList.add("active"),e!=="search"){const t=document.getElementById("visualSearchPreview");if(t){t.style.display="none";const n=document.getElementById("visualSearchImage");n&&(n.value="")}}}document.getElementById("itemForm").addEventListener("submit",async e=>{e.preventDefault();const t=e.target,n=t.dataset.editId,a={title:document.getElementById("itemTitle").value,quantity:parseInt(document.getElementById("itemQuantity").value),location:document.getElementById("itemLocation").value};if(n){a.id=parseInt(n);const o=await m.get("items",a.id);a.image=o.image,a.createdAt=o.createdAt}const r=document.getElementById("itemImage").files[0];r&&(a.image=await P(r)),await le(a),t.reset(),delete t.dataset.editId,document.getElementById("imagePreview").innerHTML="",document.getElementById("cancelBtn").style.display="none",await u(),w("search")});document.getElementById("cancelBtn").addEventListener("click",()=>{const e=document.getElementById("itemForm");e.reset(),delete e.dataset.editId,document.getElementById("imagePreview").innerHTML="",document.getElementById("cancelBtn").style.display="none",w("search")});document.getElementById("takePictureBtn").addEventListener("click",()=>{document.getElementById("itemImage").click()});document.getElementById("itemImage").addEventListener("change",async e=>{const t=e.target.files[0];if(t){const n=await P(t);document.getElementById("imagePreview").innerHTML=`<img src="${n}" alt="Preview">`;const a=document.getElementById("itemTitle");if(C()&&(!a.value||a.value.trim()==="")){a.placeholder="ü§ñ AI analyserar bilden...",a.disabled=!0;const o=URL.createObjectURL(t),i=await ge(o);i&&(a.value=i),a.placeholder="T.ex. Skruvmejsel",a.disabled=!1,URL.revokeObjectURL(o)}}});document.getElementById("searchInput").addEventListener("input",async e=>{const t=e.target.value;if(t){const a=document.getElementById("visualSearchPreview");a.style.display!=="none"&&(a.style.display="none",document.getElementById("visualSearchImage").value="")}const n=await ue(t);await u(n)});document.getElementById("visualSearchBtn").addEventListener("click",()=>{document.getElementById("visualSearchImage").click()});document.getElementById("visualSearchImage").addEventListener("change",async e=>{const t=e.target.files[0];if(!t)return;if(!C()){alert("‚ö†Ô∏è AI-funktionen √§r inaktiverad. Aktivera den i Inst√§llningar f√∂r att anv√§nda bilds√∂k.");return}try{const a=await P(t),r=document.getElementById("visualSearchPreview");r.style.display="block",r.innerHTML=`
            <div class="preview-content">
                <img src="${a}" alt="S√∂kbild">
                <div class="preview-info">
                    <p><strong>üîç S√∂ker efter liknande saker...</strong></p>
                    <p id="searchStatus">Analyserar bild...</p>
                </div>
                <button class="clear-search" id="clearVisualSearch">‚úï Rensa</button>
            </div>
        `;const o=URL.createObjectURL(t),i=await fe(o);if(URL.revokeObjectURL(o),i){document.getElementById("searchStatus").textContent=`Hittade: "${i}"`;const s=await ye(i);s.length>0?(await u(s),document.getElementById("searchStatus").textContent=`Hittade ${s.length} liknande ${s.length===1?"sak":"saker"}`):(await u([]),document.getElementById("searchStatus").textContent="Inga liknande saker hittades")}else document.getElementById("searchStatus").textContent="Kunde inte analysera bilden",await u([]);document.getElementById("clearVisualSearch").addEventListener("click",async()=>{document.getElementById("visualSearchPreview").style.display="none",document.getElementById("searchInput").value="",document.getElementById("visualSearchImage").value="",await u()})}catch(a){console.error("Fel vid visuell s√∂kning:",a),alert("‚ùå Kunde inte s√∂ka med bild: "+a.message),document.getElementById("visualSearchPreview").style.display="none"}});document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{w(e.dataset.tab)})});document.querySelector(".close").addEventListener("click",()=>{document.getElementById("itemModal").classList.remove("active")});window.addEventListener("click",e=>{const t=document.getElementById("itemModal");e.target===t&&t.classList.remove("active")});async function Ie(){try{return"caches"in window?(await caches.keys()).filter(n=>n.includes("transformers")||n.includes("huggingface")).length>0?"Nedladdad (~100 MB)":"Inte nedladdad":"Ok√§nd"}catch(e){return console.error("Kunde inte kontrollera cache:",e),"Ok√§nd"}}async function he(){try{if("caches"in window){const t=(await caches.keys()).filter(n=>n.includes("transformers")||n.includes("huggingface")||n.includes("onnx"));for(const n of t)await caches.delete(n),console.log(`Rensade cache: ${n}`);return f=null,I=null,t.length}return 0}catch(e){throw console.error("Kunde inte rensa cache:",e),e}}async function A(){const e=await Ie(),t=document.getElementById("aiStatus");t&&(t.textContent=e,t.style.color=e.includes("Nedladdad")?"var(--accent)":"var(--text-secondary)");const n=await v(),a=document.getElementById("itemCount");a&&(a.textContent=n.length);const r=document.getElementById("enableAI");r&&(r.checked=C())}var R;(R=document.getElementById("enableAI"))==null||R.addEventListener("change",e=>{se(e.target.checked),console.log("AI-funktionalitet:",e.target.checked?"Aktiverad":"Inaktiverad")});var $;($=document.getElementById("clearAICache"))==null||$.addEventListener("click",async()=>{if(confirm("√Ñr du s√§ker p√• att du vill rensa AI-modellen? Dina sparade saker p√•verkas inte."))try{const e=document.getElementById("clearAICache");e.disabled=!0,e.textContent="üîÑ Rensar...";const t=await he();t>0?alert(`‚úÖ AI-modellen har rensats! ${t} cache(s) borttagna.`):alert("‚ÑπÔ∏è Ingen AI-modell hittades att rensa."),await A(),e.disabled=!1,e.textContent="üóëÔ∏è Rensa AI-modell (frig√∂r ~100 MB)"}catch(e){alert("‚ùå Kunde inte rensa AI-modellen: "+e.message);const t=document.getElementById("clearAICache");t.disabled=!1,t.textContent="üóëÔ∏è Rensa AI-modell (frig√∂r ~100 MB)"}});async function ve(){await ce(),await u(),await A(),document.querySelectorAll(".tab-btn").forEach(e=>{e.dataset.tab==="settings"&&e.addEventListener("click",A)})}ve();
